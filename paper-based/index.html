<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="jquery-1.7.2.js"></script>
<script type="text/javascript" src="paperjs-v0.9.15/dist/paper.js"></script>
<script type="text/javascript" src="roi-editor.js"></script>
<!-- Define inlined JavaScript -->
<script type="text/javascript">

        var ROI_MIN_SIZE = 20;

        var loadROIsFromJson = function(shapeCallback) {

            var processShape = function(obj, shape) {
                obj.data.original = shape;

                obj.style.strokeColor = shape.strokeColor;
                obj.style.strokeColor.alpha = shape.strokeAlpha;
                obj.style.strokeWidth = shape.stokeWidth;

                obj.style.fillColor = shape.fillColor;
                obj.style.fillColor.alpha = shape.fillAlpha;

                obj.data.label = shape.textValue;

                shapeCallback(obj);
            };

            var loaders = {
                'Rectangle': function(shape) {
                    processShape(new paper.Path.Rectangle(
                        shape.x, shape.y, shape.width, shape.height), shape);
                },
                'Ellipse': function(shape) {
                    processShape(new paper.Path.Ellipse({
                        center: [shape.cx, shape.cy],
                        radius: [shape.rx, shape.ry]
                    }), shape);
                }
            };

            $.getJSON(
                "test.json",
                function(data) {
                    for (roi in data) {
                        for (idx in data[roi].shapes) {
                            var shape = data[roi].shapes[idx];
                            if (shape.theZ === 0 && shape.theT === 0 &&
                                loaders[shape.type] !== undefined) {
                                loaders[shape.type](shape);
                            }
                        }
                    }
                    paper.view.draw();
                }
            )
        };


	$(document).ready(function() {

            roiEditor(document.getElementById('myCanvas'), loadROIsFromJson);

            var image = new paper.Raster("image").sendToBack();
            image.translate(image.width / 2, image.height / 2);

        });
</script>
</head>
<body>
	<canvas id="myCanvas" style="width: 600px; height: 400px; border: solid red 1px;"></canvas>

        <br /><br /><br />

        <button id="toggle-rois">Toggle ROIs</button>

        <button id="edit-roi">Edit</button>

        <button id="edit-roi-label">Edit Label</button>

        <button id="delete-roi">Delete</button>

        <button id="add-rectangle-roi">Rectangle</button>

        <button id="add-ellipse-roi">Ellipse</button>

        <button id="undo"></button>

        <button id="redo"></button>

        Zoom: <input type="number" min="0" max="1000" id="zoom-tool" value="100" step="10" />

        <img src="sample.jpg" style="display: none;" id="image" />

        <img src="sample.jpg" style="width: 200px; height: 200px;" />
</body>
</html>
